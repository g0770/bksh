<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BKSH – Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
</head>

<body class="bg-dark">
  <header class="py-5">
    <div class="container">
      <h1 class="display-3 fw-bold text">BKSH</h1>
      <form class="row g-3 mt-3" method="GET" action="{{ url_for('home') }}">
        <div class="col-md-6">
          <input type="text" class="form-control" name="q" placeholder="Buscar libros..." value="{{ q or '' }}">
        </div>
        <div class="col-md-3">
          <select class="form-select" name="scope" aria-label="Ámbito">
            <option value="all" {{ 'selected' if scope=='all' else '' }}>Todos</option>
            <option value="mine" {{ 'selected' if scope=='mine' else '' }}>Solo mis libros</option>
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-select" name="sort" aria-label="Orden">
            <option value="updated_desc" {{ 'selected' if sort=='updated_desc' else '' }}>Más recientes (actualizados)
            </option>
            <option value="created_desc" {{ 'selected' if sort=='created_desc' else '' }}>Más recientes (creados)
            </option>
          </select>
        </div>
        <div class="col-12">
          <button class="btn btn-primary">Buscar</button>
        </div>
      </form>
    </div>
  </header>

  <main class="container pb-5">
    {% if q or scope != 'all' or sort != 'updated_desc' %}
    <section class="mb-5">
      <h4 class="text mb-3">Resultados de búsqueda</h4>
      {% if search_results %}
      <div class="row g-3">
        {% for b in search_results %}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card p-3 h-100">
            <h5 class="text mb-1">{{ b.title }}</h5>
            {% if b.subtitle %}<p class="text-50 mb-2 text">{{ b.subtitle }}</p>{% endif %}
            <a class="btn btn-outline-light mt-auto" href="{{ url_for('book_detail', book_id=b.id) }}">Ver detalles</a>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text">No se encontraron libros con ese criterio.</p>
      {% endif %}
    </section>
    <hr class="border-secondary" />
    {% endif %}

    <section class="mb-5">
      <div class="d-flex align-items-center justify-content-between">
        <h4 class="text mb-3">Mis últimos 5 libros</h4>
        <a class="btn btn-secondary" href="{{ url_for('my_books') }}">Ver todos los libros</a>
      </div>
      {% if last_5_mine %}
      <div class="row g-3">
        {% for b in last_5_mine %}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card p-3 h-100">
            <h5 class="text mb-1">{{ b.title }}</h5>
            {% if b.subtitle %}<p class="text-50 mb-2 text">{{ b.subtitle }}</p>{% endif %}
            <small class="text">Creado: {{ b.creation_date.strftime('%Y-%m-%d %H:%M') if b.creation_date else ''
              }}</small>
            <a class="btn btn-outline-light mt-3" href="{{ url_for('book_detail', book_id=b.id) }}">Abrir</a>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text">Todavía no creaste libros.</p>
      {% endif %}
    </section>

    <section>
      <h4 class="text mb-3">Últimos 10 libros actualizados</h4>
      {% if last_10_updated %}
      <div class="row g-3">
        {% for b in last_10_updated %}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card p-3 h-100">
            <h5 class="text mb-1">{{ b.title }}</h5>
            {% if b.subtitle %}<p class="text-50 mb-2 text">{{ b.subtitle }}</p>{% endif %}
            <small class="text">Actualizado: {{ b.last_update_date.strftime('%Y-%m-%d %H:%M') if b.last_update_date else
              '' }}</small>
            <a class="btn btn-outline-light mt-3" href="{{ url_for('book_detail', book_id=b.id) }}">Ver</a>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text">No hay libros actualizados recientemente.</p>
      {% endif %}
    </section>
  </main>
</body>

</html>